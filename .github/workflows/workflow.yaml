name: CI/CD Medical Model Tests

on:
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    # Comentario inicial en el PR
    - name: Comment PR - Start
      uses: thollander/actions-comment-pull-request@v2
      with:
        message: |
          ğŸš€ **CI/CD en acciÃ³n. Ejecutando tareas...** 
          
          Se estÃ¡n ejecutando las siguientes verificaciones:
          - âœ… ConfiguraciÃ³n de entorno Python
          - âœ… InstalaciÃ³n de dependencias
          - âœ… EjecuciÃ³n de pruebas unitarias
          - âœ… VerificaciÃ³n de funcionalidad de endpoints
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    # Checkout del cÃ³digo
    - uses: actions/checkout@v4
    
    # Configurar Python
    - name: Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: 3.9
    
    # Instalar dependencias
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    # Ejecutar las pruebas
    - name: Run tests with pytest
      run: |
        pytest test_app.py -v --tb=short
    
    # Comentario final de Ã©xito
    - name: Comment PR - Success
      if: success()
      uses: thollander/actions-comment-pull-request@v2
      with:
        message: |
          âœ… **CI/CD terminado con Ã©xito.**
          
          ğŸ“Š **Resumen de resultados:**
          - âœ… Todas las pruebas unitarias pasaron correctamente
          - âœ… Endpoints de API funcionando correctamente
          - âœ… LÃ³gica de predicciÃ³n mÃ©dica validada
          - âœ… Sistema de estadÃ­sticas verificado
          
          ğŸ‰ El cÃ³digo estÃ¡ listo para ser integrado a la rama main.
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    # Comentario final de fallo
    - name: Comment PR - Failure
      if: failure()
      uses: thollander/actions-comment-pull-request@v2
      with:
        message: |
          âŒ **CI/CD terminado con errores.**
          
          ğŸ’¥ **Se encontraron problemas:**
          - Las pruebas unitarias fallaron
          - Revisa los logs de ejecuciÃ³n para mÃ¡s detalles
          - Corrige los errores antes de hacer merge a main
          
          ğŸ”§ Por favor, revisa el cÃ³digo y ejecuta las pruebas localmente antes de hacer push.
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}